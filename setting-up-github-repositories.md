# Setting up github repositories for specifications

This document tries to describe how we set up github repositories
for specifications or specification-like documents.
These documents are generally maintained in either
[bikeshed](https://github.com/tabatkins/bikeshed/)
or
[respec](https://github.com/w3c/respec/).

Also see [W3C's FAQ on using GitHub](https://w3c.github.io/faq.html).

## Structuring the repository

Structure your branch names without concern for any features offered by GitHub.  In particular, don't commit source to a `gh-pages` branch.  (In some cases automation may commit generated output to a `gh-pages` branch, though.)  Note that some of our existing repositories do not follow this advice and commit respec source to a `gh-pages` branch.

This branch should contain only the source; files generated by bikeshed (or respec) should not be committed.

## Configuring the document

**TODO**: Write something about how to configure settings in bikeshed and in respec.

## Configuring github settings

After creating the repository, change the following aspects of its settings:
1. In the **Options** tab, under **Merge button**, uncheck **Allow merge commits**
2. In the **Options** tab, under **GitHub Pages**, set the **Source**:
   * for bikeshed specs, set it to **gh-pages**
   * for respec specs, set it to **master** or whatever the primary branch is (note that some older specs use `gh-pages`, but this is no longer needed)
3. In the **Branches** tab, under **Branch protection rules**, choose **Add rule**.  Create a rule matching `master` (or whatever the primary branch is), and check the two checkboxes **Require linear history** and **Include administrators**.  (Also *consider* whether to check **Require pull request reviews before merging** or **Require status checks to pass before merging**.)

## Configuring automatic running of bikeshed

For bikeshed specs, we set up autogeneration of the bikeshed output from the source using [GitHub Actions](https://github.com/features/actions).
The source is (as described above) on the `master` branch (or whatever other name we use for the primary branch),
and we set up automatic running of `bikeshed` to generate its output and commit it to the `gh-pages` branch.
(Note that some of our existing repositories do not follow this advice and use Travis-CI for this.)

To set this up in your repository, follow these steps:

1. Add this [Makefile](Makefile.example) to your repository and name it `Makefile`.
2. Create a `.github/workflows/` directory and put [deploy.yml](deploy.yml) in it.

If the primary branch of your repository is not named `master`, you'll need to edit `deploy.yml` to reflect this.

Note that these two files assume the build directory (where the built HTML goes) is named `build`. If you want to call it something else (e.g. `out`), you'll have to update both your `Makefile` and `deploy.yml`.

## Configuring PR Preview

We have **already** set up [PR Preview](https://github.com/tobie/pr-preview) by using the steps:
1. go to [PR Preview GitHub App](https://github.com/apps/pr-preview)
2. click **Configure** on the right
3. Choose the @w3ctag organization
4. choose to set it up for **All repositories**

This means that all we need to enable PR Preview is to add a `.pr-preview.json`, which is easiest to do by using the [PR Preview setup helper](https://tobie.github.io/pr-preview/config.html) and choosing the appropriate defaults there.
